# –û–ø–∏—à–∏—Ç–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–±–æ—Ç—ã —Å –∫–æ–ª–ª–µ–∫—Ü–∏—è–º–∏ WeakMap –∏ WeakSet. –ß–µ–º –æ–Ω–∏ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –æ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏–π Map –∏ Set —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ?

**–û—Ç–≤–µ—Ç:**

üéØ **WeakMap –∏ WeakSet** ‚Äî —ç—Ç–æ **—Å–ª–∞–±—ã–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏**. –û–Ω–∏ –Ω–µ –º–µ—à–∞—é—Ç —Å–±–æ—Ä—â–∏–∫—É –º—É—Å–æ—Ä–∞ —É–¥–∞–ª—è—Ç—å –æ–±—ä–µ–∫—Ç—ã. –ö–∞–∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—Ç–∏–∫–µ—Ä—ã ‚Äî –∏—Å—á–µ–∑–∞—é—Ç –≤–º–µ—Å—Ç–µ —Å –æ–±—ä–µ–∫—Ç–æ–º!

```javascript
// üîç –û–°–ù–û–í–ù–ê–Ø –†–ê–ó–ù–ò–¶–ê - —Å–∏–ª—å–Ω—ã–µ vs —Å–ª–∞–±—ã–µ —Å—Å—ã–ª–∫–∏

// ‚ùå MAP - –°–ò–õ–¨–ù–´–ï —Å—Å—ã–ª–∫–∏ (–æ–±—ä–µ–∫—Ç –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è)
const strongMap = new Map();
let user = { name: '–ò–≤–∞–Ω', id: 1 };

strongMap.set(user, '–≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
user = null; // –û–±–Ω—É–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é

// –ù–æ –æ–±—ä–µ–∫—Ç { name: '–ò–≤–∞–Ω', id: 1 } –≤—Å—ë –µ—â—ë –∂–∏–≤ –≤ –ø–∞–º—è—Ç–∏!
// strongMap –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –¥–µ—Ä–∂–∞—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ –Ω–µ–≥–æ
console.log(strongMap.size); // 1 - –æ–±—ä–µ–∫—Ç –Ω–µ —É–¥–∞–ª–µ–Ω

// ‚úÖ WEAKMAP - –°–õ–ê–ë–´–ï —Å—Å—ã–ª–∫–∏ (–æ–±—ä–µ–∫—Ç –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å—Å—è)
const weakMap = new WeakMap();
let user2 = { name: '–ú–∞—Ä–∏—è', id: 2 };

weakMap.set(user2, '–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ');
user2 = null; // –û–±–Ω—É–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é

// –û–±—ä–µ–∫—Ç { name: '–ú–∞—Ä–∏—è', id: 2 } –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω GC
// weakMap –Ω–µ –¥–µ—Ä–∂–∏—Ç –µ–≥–æ –≤ –ø–∞–º—è—Ç–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
// console.log(weakMap.size); // ‚ùå –û—à–∏–±–∫–∞! –£ WeakMap –Ω–µ—Ç size
```

**üîç –î–ï–¢–ê–õ–¨–ù–û–ï –°–†–ê–í–ù–ï–ù–ò–ï:**

```javascript
// üÜö MAP vs WEAKMAP

// 1Ô∏è‚É£ –¢–ò–ü–´ –ö–õ–Æ–ß–ï–ô
const map = new Map();
const weakMap = new WeakMap();

// Map –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±—ã–µ –∫–ª—é—á–∏:
map.set('—Å—Ç—Ä–æ–∫–∞', '–∑–Ω–∞—á–µ–Ω–∏–µ');
map.set(123, '–∑–Ω–∞—á–µ–Ω–∏–µ');
map.set(true, '–∑–Ω–∞—á–µ–Ω–∏–µ');
map.set(Symbol('id'), '–∑–Ω–∞—á–µ–Ω–∏–µ');
map.set({ id: 1 }, '–∑–Ω–∞—á–µ–Ω–∏–µ'); // ‚úÖ –û–±—ä–µ–∫—Ç —Ç–æ–∂–µ –º–æ–∂–Ω–æ

// WeakMap –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¢–û–õ–¨–ö–û –æ–±—ä–µ–∫—Ç—ã:
// weakMap.set('—Å—Ç—Ä–æ–∫–∞', '–∑–Ω–∞—á–µ–Ω–∏–µ');    // ‚ùå TypeError!
// weakMap.set(123, '–∑–Ω–∞—á–µ–Ω–∏–µ');         // ‚ùå TypeError!
// weakMap.set(true, '–∑–Ω–∞—á–µ–Ω–∏–µ');        // ‚ùå TypeError!
weakMap.set({ id: 1 }, '–∑–Ω–∞—á–µ–Ω–∏–µ');     // ‚úÖ –¢–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã!

// 2Ô∏è‚É£ –ò–¢–ï–†–ê–¶–ò–Ø
// Map –º–æ–∂–Ω–æ –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å:
for (let [key, value] of map) {
  console.log(key, value);
}

map.forEach((value, key) => console.log(key, value));
console.log([...map.keys()]);     // –í—Å–µ –∫–ª—é—á–∏
console.log([...map.values()]);   // –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è
console.log([...map.entries()]);  // –í—Å–µ –ø–∞—Ä—ã

// WeakMap –ù–ï–õ–¨–ó–Ø –ø–µ—Ä–µ–±–∏—Ä–∞—Ç—å:
// for (let [key, value] of weakMap) { } // ‚ùå TypeError!
// weakMap.forEach(...);                 // ‚ùå –ú–µ—Ç–æ–¥–∞ –Ω–µ—Ç!
// [...weakMap.keys()];                  // ‚ùå –ú–µ—Ç–æ–¥–∞ –Ω–µ—Ç!

// 3Ô∏è‚É£ –†–ê–ó–ú–ï–† –ò –û–ß–ò–°–¢–ö–ê
console.log(map.size);        // ‚úÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
// console.log(weakMap.size); // ‚ùå –°–≤–æ–π—Å—Ç–≤–∞ –Ω–µ—Ç!

map.clear();        // ‚úÖ –û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë
// weakMap.clear(); // ‚ùå –ú–µ—Ç–æ–¥–∞ –Ω–µ—Ç!

// 4Ô∏è‚É£ –î–û–°–¢–£–ü–ù–´–ï –ú–ï–¢–û–î–´
console.log('MAP –º–µ—Ç–æ–¥—ã:', ['set', 'get', 'has', 'delete', 'clear', 'size', 'forEach', 'keys', 'values', 'entries']);
console.log('WEAKMAP –º–µ—Ç–æ–¥—ã:', ['set', 'get', 'has', 'delete']); // –¢–æ–ª—å–∫–æ 4 –º–µ—Ç–æ–¥–∞!
```

**üîç –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ò–ú–ï–ù–ï–ù–ò–Ø:**

```javascript
// 1Ô∏è‚É£ –ü–†–ò–í–ê–¢–ù–´–ï –î–ê–ù–ù–´–ï –ö–õ–ê–°–°–û–í

const privateData = new WeakMap();

class BankAccount {
  constructor(accountNumber) {
    this.accountNumber = accountNumber; // –ü—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    
    // –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ WeakMap
    privateData.set(this, {
      balance: 0,
      pin: null,
      transactionHistory: []
    });
  }
  
  setPin(pin) {
    if (pin.length !== 4) throw new Error('PIN –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 4 —Ü–∏—Ñ—Ä—ã');
    privateData.get(this).pin = pin;
  }
  
  deposit(amount, pin) {
    const data = privateData.get(this);
    if (data.pin !== pin) throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π PIN');
    
    data.balance += amount;
    data.transactionHistory.push({ type: 'deposit', amount, date: new Date() });
    
    return `–ë–∞–ª–∞–Ω—Å: ${data.balance}`;
  }
  
  getBalance(pin) {
    const data = privateData.get(this);
    if (data.pin !== pin) throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π PIN');
    return data.balance;
  }
  
  // ‚ú® –ö–æ–≥–¥–∞ –æ–±—ä–µ–∫—Ç BankAccount —É–¥–∞–ª–∏—Ç—Å—è, 
  //    –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–æ–∂–µ —É–¥–∞–ª—è—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!
}

const account = new BankAccount('123456789');
account.setPin('1234');
account.deposit(1000, '1234');

console.log(account.getBalance('1234')); // 1000

// –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã —Å–Ω–∞—Ä—É–∂–∏:
console.log(account.balance); // undefined ‚úÖ
console.log(account.pin);     // undefined ‚úÖ

// 2Ô∏è‚É£ –ö–≠–®–ò–†–û–í–ê–ù–ò–ï –†–ï–ó–£–õ–¨–¢–ê–¢–û–í –î–õ–Ø –û–ë–™–ï–ö–¢–û–í

const expensiveResultsCache = new WeakMap();

function calculateExpensiveResult(obj) {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
  if (expensiveResultsCache.has(obj)) {
    console.log('üöÄ –í–∑—è–ª–∏ –∏–∑ –∫—ç—à–∞!');
    return expensiveResultsCache.get(obj);
  }
  
  // –î–æ—Ä–æ–≥–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
  console.log('‚è≥ –í—ã–ø–æ–ª–Ω—è–µ–º –¥–æ—Ä–æ–≥–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è...');
  const result = {
    processed: true,
    hash: obj.toString().length * 42,
    timestamp: Date.now()
  };
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
  expensiveResultsCache.set(obj, result);
  return result;
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
const data1 = { important: 'data' };
const data2 = { other: 'data' };

console.log(calculateExpensiveResult(data1)); // –í—ã—á–∏—Å–ª—è–µ–º
console.log(calculateExpensiveResult(data1)); // –ò–∑ –∫—ç—à–∞ ‚úÖ
console.log(calculateExpensiveResult(data2)); // –í—ã—á–∏—Å–ª—è–µ–º

// –ö–æ–≥–¥–∞ data1 —É–¥–∞–ª–∏—Ç—Å—è, –µ–≥–æ –∫—ç—à —Ç–æ–∂–µ —É–¥–∞–ª–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

// 3Ô∏è‚É£ DOM –ú–ï–¢–ê–î–ê–ù–ù–´–ï

const elementMetadata = new WeakMap();

function enhanceElement(element) {
  elementMetadata.set(element, {
    clicks: 0,
    created: Date.now(),
    listeners: [],
    animations: []
  });
  
  const clickHandler = () => {
    const meta = elementMetadata.get(element);
    meta.clicks++;
    console.log(`–ö–ª–∏–∫–æ–≤: ${meta.clicks}`);
  };
  
  element.addEventListener('click', clickHandler);
  elementMetadata.get(element).listeners.push(clickHandler);
}

// –ö–æ–≥–¥–∞ DOM —ç–ª–µ–º–µ–Ω—Ç —É–¥–∞–ª–∏—Ç—Å—è, –µ–≥–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–æ–∂–µ —É–¥–∞–ª—è—Ç—Å—è!
```

**üîç WEAKSET - –°–õ–ê–ë–´–ï –ú–ù–û–ñ–ï–°–¢–í–ê:**

```javascript
// SET vs WEAKSET - —Ç–∞–∫–∞—è –∂–µ –ª–æ–≥–∏–∫–∞

const regularSet = new Set();
const weakSet = new WeakSet();

// Set –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
regularSet.add('—Å—Ç—Ä–æ–∫–∞');
regularSet.add(123);
regularSet.add({ id: 1 });

// WeakSet –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –¢–û–õ–¨–ö–û –æ–±—ä–µ–∫—Ç—ã:
// weakSet.add('—Å—Ç—Ä–æ–∫–∞');  // ‚ùå TypeError!
// weakSet.add(123);       // ‚ùå TypeError!
weakSet.add({ id: 1 });   // ‚úÖ –¢–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã!

// üîç –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ WeakSet:

// 1Ô∏è‚É£ –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–ï –ê–ö–¢–ò–í–ù–´–• –û–ë–™–ï–ö–¢–û–í
const activeUsers = new WeakSet();
const processedFiles = new WeakSet();

class User {
  constructor(name) {
    this.name = name;
    activeUsers.add(this); // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∞–∫—Ç–∏–≤–Ω—ã–µ
  }
  
  logout() {
    activeUsers.delete(this); // –£–±–∏—Ä–∞–µ–º –∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö
  }
}

function isUserActive(user) {
  return activeUsers.has(user);
}

const user1 = new User('–ò–≤–∞–Ω');
const user2 = new User('–ú–∞—Ä–∏—è');

console.log(isUserActive(user1)); // true
user1.logout();
console.log(isUserActive(user1)); // false

// 2Ô∏è‚É£ –ü–†–ï–î–û–¢–í–†–ê–©–ï–ù–ò–ï –ü–û–í–¢–û–†–ù–û–ô –û–ë–†–ê–ë–û–¢–ö–ò
function processFile(file) {
  if (processedFiles.has(file)) {
    console.log('–§–∞–π–ª —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω');
    return;
  }
  
  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª
  console.log(`–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º ${file.name}`);
  processedFiles.add(file);
}

const file1 = { name: 'document.pdf', size: 1024 };
processFile(file1); // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º document.pdf
processFile(file1); // –§–∞–π–ª —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω
```

**üß† –ö–∞–∫ –∑–∞–ø–æ–º–Ω–∏—Ç—å —Ä–∞–∑–Ω–∏—Ü—É?**

| –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å | **Map/Set** | **WeakMap/WeakSet** |
|-------------|-------------|---------------------|
| **–ö–ª—é—á–∏/–∑–Ω–∞—á–µ–Ω–∏—è** | –õ—é–±—ã–µ | –¢–æ–ª—å–∫–æ –æ–±—ä–µ–∫—Ç—ã |
| **–°—Å—ã–ª–∫–∏** | –°–∏–ª—å–Ω—ã–µ | –°–ª–∞–±—ã–µ |
| **–ò—Ç–µ—Ä–∞—Ü–∏—è** | –î–∞ | –ù–µ—Ç |
| **–†–∞–∑–º–µ—Ä** | `.size` | –ù–µ—Ç |
| **–û—á–∏—Å—Ç–∫–∞** | `.clear()` | –ù–µ—Ç |
| **GC** | –ú–µ—à–∞–µ—Ç | –ù–µ –º–µ—à–∞–µ—Ç |

**‚ö° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞:**

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ WeakMap –∫–æ–≥–¥–∞:**
- –ù—É–∂–Ω—ã –ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤  
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –ù–µ –Ω—É–∂–Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –∫–æ–ª–ª–µ–∫—Ü–∏–∏

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ WeakSet –∫–æ–≥–¥–∞:**
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –í—Ä–µ–º–µ–Ω–Ω–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –æ–±—ä–µ–∫—Ç–æ–≤

‚ùå **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Weak* –∫–æ–≥–¥–∞:**
- –ù—É–∂–Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏—è –ø–æ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- –ù—É–∂–Ω–æ –∑–Ω–∞—Ç—å —Ä–∞–∑–º–µ—Ä –∫–æ–ª–ª–µ–∫—Ü–∏–∏
- –ö–ª—é—á–∏/–∑–Ω–∞—á–µ–Ω–∏—è ‚Äî –ø—Ä–∏–º–∏—Ç–∏–≤—ã
- –ù—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ `.clear()`

**–í—ã–≤–æ–¥:**
WeakMap/WeakSet ‚Äî —ç—Ç–æ "—É–º–Ω—ã–µ" –∫–æ–ª–ª–µ–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –æ–±—ä–µ–∫—Ç–∞–º–∏. –ò–¥–µ–∞–ª—å–Ω—ã –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö! 