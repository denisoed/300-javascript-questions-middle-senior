# –ß–µ–º Observable –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç Promise?

**–û—Ç–≤–µ—Ç:**

üéØ **Promise** ‚Äî —ç—Ç–æ **–æ–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –∫–æ—Ä–æ–±–∫–∞** —Å –æ–¥–Ω–∏–º –ø–æ–¥–∞—Ä–∫–æ–º. **Observable** ‚Äî —ç—Ç–æ **–∫–æ–Ω–≤–µ–π–µ—Ä–Ω–∞—è –ª–µ–Ω—Ç–∞** —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º –ø–æ–¥–∞—Ä–∫–æ–≤. Promise –¥–ª—è —Ä–∞–∑–æ–≤–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞, Observable –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö!

```javascript
// üîç –û–°–ù–û–í–ù–ê–Ø –†–ê–ó–ù–ò–¶–ê - –æ–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ vs –ø–æ—Ç–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π

// üì¶ PROMISE - –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
const userPromise = fetch('/api/user')
  .then(response => response.json())
  .then(user => {
    console.log('–ü–æ–ª—É—á–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', user);
    return user;
  });

// userPromise –≤—ã–¥–∞—Å—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –û–î–ò–ù —Ä–∞–∑ –∏ –≤—Å—ë!

// üåä OBSERVABLE - –ø–æ—Ç–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π (–∫–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ)
class SimpleObservable {
  constructor(subscriberFn) {
    this.subscriberFn = subscriberFn;
  }
  
  subscribe(observer) {
    return this.subscriberFn(observer);
  }
}

// Observable –¥–ª—è –∫–ª–∏–∫–æ–≤ –º—ã—à–∏
const clickStream = new SimpleObservable(observer => {
  const handleClick = (event) => {
    observer.next(event); // –ú–Ω–æ–≥–æ —Å–æ–±—ã—Ç–∏–π!
  };
  
  document.addEventListener('click', handleClick);
  
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—Ç–ø–∏—Å–∫–∏
  return () => {
    document.removeEventListener('click', handleClick);
  };
});

// –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –ø–æ—Ç–æ–∫
const unsubscribe = clickStream.subscribe({
  next: (event) => console.log('–ö–ª–∏–∫!', event.clientX, event.clientY),
  error: (error) => console.error('–û—à–∏–±–∫–∞:', error),
  complete: () => console.log('–ü–æ—Ç–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω')
});

// –ú–æ–∂–µ–º –æ—Ç–ø–∏—Å–∞—Ç—å—Å—è –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
setTimeout(() => unsubscribe(), 5000); // –ß–µ—Ä–µ–∑ 5 —Å–µ–∫ –æ—Ç–ø–∏—Å–∫–∞
```

**üîç –î–ï–¢–ê–õ–¨–ù–û–ï –°–†–ê–í–ù–ï–ù–ò–ï:**

```javascript
// 1Ô∏è‚É£ –ö–û–õ–ò–ß–ï–°–¢–í–û –ó–ù–ê–ß–ï–ù–ò–ô

// Promise: 0 –∏–ª–∏ 1 –∑–Ω–∞—á–µ–Ω–∏–µ –º–∞–∫—Å–∏–º—É–º
const getUserData = () => {
  return fetch('/api/user') // –û–¥–∏–Ω HTTP –∑–∞–ø—Ä–æ—Å
    .then(res => res.json()) // –û–¥–∏–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    .then(user => user);     // –û–¥–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ
};

getUserData().then(user => {
  console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user); // –°—Ä–∞–±–æ—Ç–∞–µ—Ç –û–î–ò–ù —Ä–∞–∑
});

// Observable: 0, 1 –∏–ª–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –º–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–π
const mousePosition = new SimpleObservable(observer => {
  const handleMove = (event) => {
    observer.next({ x: event.clientX, y: event.clientY }); // –ú–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–π!
  };
  
  document.addEventListener('mousemove', handleMove);
  return () => document.removeEventListener('mousemove', handleMove);
});

mousePosition.subscribe({
  next: (pos) => console.log(`–ü–æ–∑–∏—Ü–∏—è: ${pos.x}, ${pos.y}`), // –°—Ä–∞–±–æ—Ç–∞–µ—Ç –ú–ù–û–ì–û —Ä–∞–∑
});

// 2Ô∏è‚É£ –ó–ê–ü–£–°–ö –í–´–ü–û–õ–ù–ï–ù–ò–Ø: EAGER vs LAZY

// Promise - EAGER (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É)
console.log('–°–æ–∑–¥–∞–µ–º Promise...');
const eagerPromise = new Promise(resolve => {
  console.log('Promise –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ!'); // –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Å—Ä–∞–∑—É!
  setTimeout(() => resolve('–ì–æ—Ç–æ–≤–æ'), 1000);
});

console.log('Promise —Å–æ–∑–¥–∞–Ω');
// –£–∂–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è! –î–∞–∂–µ –µ—Å–ª–∏ .then() –Ω–µ –≤—ã–∑–≤–∞–ª–∏

setTimeout(() => {
  eagerPromise.then(result => console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', result));
}, 2000); // Promise —É–∂–µ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è –∫ —ç—Ç–æ–º—É –º–æ–º–µ–Ω—Ç—É

// Observable - LAZY (–∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ)
console.log('–°–æ–∑–¥–∞–µ–º Observable...');
const lazyObservable = new SimpleObservable(observer => {
  console.log('Observable –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –ø—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ!'); // –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ subscribe!
  setTimeout(() => observer.next('–ì–æ—Ç–æ–≤–æ'), 1000);
});

console.log('Observable —Å–æ–∑–¥–∞–Ω, –Ω–æ –ù–ï –∑–∞–ø—É—â–µ–Ω');

setTimeout(() => {
  lazyObservable.subscribe({
    next: result => console.log('–†–µ–∑—É–ª—å—Ç–∞—Ç:', result)
  });
}, 2000); // –¢–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è!

// 3Ô∏è‚É£ –û–¢–ú–ï–ù–ê –í–´–ü–û–õ–ù–ï–ù–ò–Ø

// Promise - –ù–ï–õ–¨–ó–Ø –æ—Ç–º–µ–Ω–∏—Ç—å
const longRunningPromise = new Promise(resolve => {
  const timeoutId = setTimeout(() => {
    resolve('–ì–æ—Ç–æ–≤–æ –ø–æ—Å–ª–µ –¥–æ–ª–≥–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è');
  }, 10000); // 10 —Å–µ–∫—É–Ω–¥
  
  // –ù–µ—Ç —Å–ø–æ—Å–æ–±–∞ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç timeout –∏–∑–≤–Ω–µ!
});

// longRunningPromise.cancel(); // ‚ùå –¢–∞–∫–æ–≥–æ –º–µ—Ç–æ–¥–∞ –Ω–µ—Ç!

// Observable - –ú–û–ñ–ù–û –æ—Ç–º–µ–Ω–∏—Ç—å
const longRunningObservable = new SimpleObservable(observer => {
  const timeoutId = setTimeout(() => {
    observer.next('–ì–æ—Ç–æ–≤–æ –ø–æ—Å–ª–µ –¥–æ–ª–≥–æ–≥–æ –æ–∂–∏–¥–∞–Ω–∏—è');
  }, 10000);
  
  // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –æ—á–∏—Å—Ç–∫–∏
  return () => {
    clearTimeout(timeoutId);
    console.log('Observable –æ—Ç–º–µ–Ω–µ–Ω!');
  };
});

const subscription = longRunningObservable.subscribe({
  next: result => console.log(result)
});

// –û—Ç–º–µ–Ω—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
setTimeout(() => {
  subscription(); // ‚úÖ –û—Ç–º–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç!
}, 2000);

// 4Ô∏è‚É£ –û–ü–ï–†–ê–¢–û–†–´ –ò –¢–†–ê–ù–°–§–û–†–ú–ê–¶–ò–ò

// Promise - –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
const promiseChain = fetch('/api/users')
  .then(response => response.json())          // –ü–∞—Ä—Å–∏–Ω–≥
  .then(users => users.filter(u => u.active)) // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
  .then(active => active.map(u => u.name))    // –ú–∞–ø–ø–∏–Ω–≥
  .catch(error => console.error(error));      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

// Observable - –±–æ–≥–∞—Ç—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã (–≤ RxJS)
// const userStream = fromFetch('/api/users').pipe(
//   map(response => response.json()),
//   switchMap(users => from(users)),
//   filter(user => user.active),
//   map(user => user.name),
//   debounceTime(300),           // –î–µ–±–∞—É–Ω—Å
//   distinctUntilChanged(),      // –¢–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ
//   retry(3),                    // –ü–æ–≤—Ç–æ—Ä –ø—Ä–∏ –æ—à–∏–±–∫–µ
//   catchError(err => of(null))  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
// );
```

**üîç –ü–†–ê–ö–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ò–ú–ï–†–´:**

```javascript
// 1Ô∏è‚É£ PROMISE - –¥–ª—è —Ä–∞–∑–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

// HTTP –∑–∞–ø—Ä–æ—Å—ã
async function getUser(id) {
  try {
    const response = await fetch(`/api/users/${id}`);
    const user = await response.json();
    return user; // –û–¥–∏–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  } catch (error) {
    throw new Error(`–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: ${error.message}`);
  }
}

// –ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
function readFile(path) {
  return new Promise((resolve, reject) => {
    // fs.readFile(path, (err, data) => {
    //   if (err) reject(err);
    //   else resolve(data); // –û–¥–∏–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    // });
  });
}

// 2Ô∏è‚É£ OBSERVABLE - –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π

// –ü–æ—Ç–æ–∫ –≤–µ–±-—Å–æ–∫–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π  
const websocketStream = new SimpleObservable(observer => {
  const socket = new WebSocket('ws://localhost:8080');
  
  socket.onmessage = (event) => {
    observer.next(JSON.parse(event.data)); // –ú–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π
  };
  
  socket.onerror = (error) => {
    observer.error(error);
  };
  
  socket.onclose = () => {
    observer.complete();
  };
  
  return () => {
    socket.close(); // –û—Ç–ø–∏—Å–∫–∞ = –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
  };
});

// –ü–æ—Ç–æ–∫ –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
const timerStream = new SimpleObservable(observer => {
  let count = 0;
  const intervalId = setInterval(() => {
    observer.next(count++); // –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –ø–æ—Ç–æ–∫ —á–∏—Å–µ–ª
  }, 1000);
  
  return () => {
    clearInterval(intervalId);
  };
});

// –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ—Ç–æ–∫
const searchStream = new SimpleObservable(observer => {
  const input = document.querySelector('#search');
  
  const handleInput = (event) => {
    const query = event.target.value;
    if (query.length > 2) {
      observer.next(query); // –ü–æ—Ç–æ–∫ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
    }
  };
  
  input.addEventListener('input', handleInput);
  return () => input.removeEventListener('input', handleInput);
});

// 3Ô∏è‚É£ –û–ë–™–ï–î–ò–ù–ï–ù–ò–ï PROMISE + OBSERVABLE

// Observable –¥–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ—Ç–º–µ–Ω–æ–π
function createCancellableRequest(url) {
  return new SimpleObservable(observer => {
    const controller = new AbortController();
    
    fetch(url, { signal: controller.signal })
      .then(response => response.json())
      .then(data => {
        observer.next(data);
        observer.complete();
      })
      .catch(error => {
        if (!controller.signal.aborted) {
          observer.error(error);
        }
      });
    
    // –§—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ–Ω—ã
    return () => {
      controller.abort();
    };
  });
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
const request = createCancellableRequest('/api/data');
const unsubscribe = request.subscribe({
  next: data => console.log('–î–∞–Ω–Ω—ã–µ:', data),
  error: err => console.error('–û—à–∏–±–∫–∞:', err),
  complete: () => console.log('–ó–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–µ–Ω')
});

// –û—Ç–º–µ–Ω—è–µ–º —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
setTimeout(unsubscribe, 2000);
```

**üß† –ö–∞–∫ –∑–∞–ø–æ–º–Ω–∏—Ç—å?**

| –ê—Å–ø–µ–∫—Ç | **Promise** | **Observable** |
|---------|-------------|----------------|
| **–ê–Ω–∞–ª–æ–≥–∏—è** | üì¶ –ö–æ—Ä–æ–±–∫–∞ | üåä –†–µ–∫–∞ |
| **–ó–Ω–∞—á–µ–Ω–∏–π** | 1 —Ä–∞–∑ | –ú–Ω–æ–≥–æ —Ä–∞–∑ |
| **–ó–∞–ø—É—Å–∫** | –°—Ä–∞–∑—É (Eager) | –ü—Ä–∏ –ø–æ–¥–ø–∏—Å–∫–µ (Lazy) |
| **–û—Ç–º–µ–Ω–∞** | ‚ùå –ù–µ–ª—å–∑—è | ‚úÖ –ú–æ–∂–Ω–æ |
| **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** | HTTP, —Ñ–∞–π–ª—ã | –°–æ–±—ã—Ç–∏—è, —Å—Ç—Ä–∏–º—ã |

**‚ö° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞:**

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Promise –¥–ª—è:**
- HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- –ß—Ç–µ–Ω–∏—è/–∑–∞–ø–∏—Å–∏ —Ñ–∞–π–ª–æ–≤  
- –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü—Ä–æ—Å—Ç—ã—Ö —Ü–µ–ø–æ—á–µ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Observable –¥–ª—è:**
- –°–æ–±—ã—Ç–∏–π DOM (–∫–ª–∏–∫–∏, –≤–≤–æ–¥)
- WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ò–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –°–ª–æ–∂–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π/—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

**–í—ã–≤–æ–¥:**
Promise = –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, Observable = –ø–æ—Ç–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π. Promise –ø—Ä–æ—â–µ, Observable –º–æ—â–Ω–µ–µ –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤! 